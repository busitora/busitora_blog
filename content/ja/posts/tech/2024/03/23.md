---
author: "Hugo Authors"
title: "システム設計の面接試験のメモ"
date: 2024-03-23
description: "システム設計の面接試験のメモ"
hideToc: false
draft: false
enableToc: true
enableTocContent: false
author: ブシトラ
authorEmoji: 🐯
tags:
- book
image: images/book/system_interview.jpg
---

輪読会で読むことになったので、メモ

## 1章 ユーザー数0から数百万人のスケールアップ

トラフィックをさばくための説明が多い。

- 非リレーショナルデータベース使うときはこんなとき

```
データが構造化されたグループに限定されていない場合
柔軟性の高い機能を実行する必要がある場合
より多様な入力を行う必要がある場合
データへのアクセスをより迅速に提供できる場合
形状やサイズが柔軟であったり、将来的に変化する可能性のあるデータを保存する場合
データリレーションシップが表形式のプライマリキーと外部キーの形式にうまく収まらない場合
```

- 垂直スケーリングと水平スケーリング → 基本水平でロードバランサーよね。
- データベースはマスターとスレーブ用意して、読み込みはスレーブで行おう
- キャッシュを使用する注意点 → 揮発性、有効期限、一貫性
たしかに、キャッシュのキー重複すると書き換わるので注意せんとあかん

### 1章まとめ

どうスケーリングするか

```
Web層はステートレスに保つ
状態データを外に出す
各階層で冗長性を確保する
可能な限りデータをキャッシュする
キャッシュ有効期限
静的コンテンツをCDNでホスティング
CDNフォールバック (CDNの故障をクライアントが検知し、オリジンにリソースをリクエストできる状態にする)
シャーディングによるデータ層の拡張
セレブ問題 (= ホットスポット・キー問題）が発生する可能性がある
複数のDBサーバを跨ってシャーディングされるとJOINが難しい。一般的な回避策はDBの非正規化
システムの監視と自動化
```

## 2章 おおまかな見積もり

覚えておくべき概念

- 2のべき乗
- レイテンシ数値 (プログラマが知っておくべきレイテンシの数値
でぐぐろう)
```
メモリは早いが、ディスクは遅い
可能ならディスクのシークは避ける
単純な圧縮アルゴリズムは速い
可能であれば、インターネット送信前にデータを圧縮する
データセンターは通常、異なる地域にあり、データセンターにデータを送るのに時間がかかる
```
- 可用性の数値 → SLA(稼働率)を 99.xxx％でできる限り100に近づける

### 例: Twitterの QPSのストレージ見積もり

前提条件
- 月間アクティブユーザ数3億人
- 50%のユーザが毎日Twitterを利用
- ユーザは1日平均2件のツイートを投稿
- ツイートの10%はメディアを含む
- データは5年間保存

#### 推定値
- デイリーアクティブユーザ(DAU) → 3億人 * 50% = 1億5000万人 
- ツイートのQPS → 1億5000万 * 2ツイート/ 24時間 / 3600秒間 = ~3500
- ピーク時のQPS → 2 * QPS = ~7000
#### 平均的なツイートサイズ
- ツイートID → 64B
- テキスト → 140B
- メディア → 1MB
- メディアの保存量 → 1億5000万210%*1MB = 30TB/日
- 5年間のメディア保存量 →30TB * 365 * 5 = ~55PB

メモ
```
QPS、ピークQPS、ストレージ、キャッシュ、サーバー数 を計算しておくと面接で◯
```

## 3章 システム設計の面接試のフレームワーク

- システム設計の利点は、問題解決の疑似体験ができること
- 協調性、重圧可での仕事ぶり、曖昧さを建設的に議論できるか がみられてる
- 視野の狭さ、過剰ながんこさ、オーバーエンジニアリングでトレードオフ考えないのは駄目

### ステップ1: 問題を理解し、設計範囲を明確にする

いきなり飛びつくのではなく、具体を明確に、ユーザー数、サービスのスケール、技術的課題、等聞く。

### ステップ2: 高度な設計を提案し、賛同を得る

省略

### ステップ3: 設計の深堀り

面接官の思考性にあわせて、深ぼる要素を選定する
→ つまり、面接官を事前に調査できるとなおヨシ


### ステップ4: まとめ

やるべきこと → 前提を質問し、コミュニケーションとりながらすすめること
やるべきでないこと → 一つに深ぼりすぎること、コミュニケーションをとらないこと。(大事なので2回)

時間配分 
```
ステップ1: 設計範囲を明確にする 3~10分
ステップ2: 高度な設計を提案し、賛同を得る 10~15分
ステップ3: 設計を深堀りする 10~25分
ステップ4: まとめる 3~5分

```
