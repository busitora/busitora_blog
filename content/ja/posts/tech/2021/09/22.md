---
author: "Hugo Authors"
title: "テスト駆動開発"
date: 2021-09-23
description: "テスト駆動開発の感想と要約をします"
# draft: true
draft: false
hideToc: false
enableToc: true
enableTocContent: false
author: ブシトラ
authorEmoji: 🐯
tags:
- test
image: images/test/test-driven-development.jpg
---

## はじめに

実務でテストの重要性を嫌というほど感じているので、読む。

自分用メモで気づきメインで書くので、
詳しく知りたい人は購入することを推奨。
こういう題材ってJavaとか多いよな。。

各章で、章の感想記事を読んだりして貼ることもある。

{{< alert theme="info" >}}
コードを書く前に、失敗する自動テストコードを必ず書く
重複を除去する
{{< /alert >}}

## 1部 多国通貨

1. 目標をTODOリストとして書き出す
2. TODOリストから一つピックアップし、テストを書く
3. テストコードを実行して失敗させる（レッド）
4. 実装コードを書く
5. できる限り最短でテストが通るコードを実装する（グリーン）
6. コードの重複を除去する（リファクタリング）
7. 次のTODOを選び、2に進む

{{< alert theme="info" >}}
決してテストを書くことが目的ではなく，このサイクルを回すことで「動作する」「きれいな」コードを書くのが目的です．
{{< /alert >}}

### 1章 仮実装

機能を作る時はTodoリストを準備する。
細かいステップを踏み続けられるようになることが重要、
### 2章 明白な実装

仮実装→コードでまずベタ書きの値を使い、実装をすすめるに従って
徐々に変数に置き換えていく。

明白な実装 → すぐに頭の中の実装をコードに落とす
### 3章 三角測量

ValueObject → その名のとおり値を表すオブジェクト。ここでいう値とはドメイン駆動設計という設計手法に登場する概念

```java
public class MoneyTest {
    @Test
    public void testEquality() {
        assertTrue(new Dollar(5).equals(new Dollar(5)));
        assertFalse(new Dollar(5).equals(new Dollar(6)));
    }
}
```
同じインスタンスでテストが通ることもあるので、Trueを書いたらFalseも実装すると、テストとして担保される。

ただ、どうやってリファクタリングをするかわからない時などに使うべきなので、一時的に使用するといい感じ。
### 第4章 意図を語るテスト

値をそのまま比較するのではなく、オブジェクトどうしで比較してテストすることで、テストの意図を明確にできる。

値で比較しないことにより、`amount`をprivateメソッドにできるのは参考になる。

### 第5章 原則をあえて破る時

・コピーアンドペーストによる再利用は、きれいな設計を壊すため抽象化の敗北になる。

素早く通るために、重複とかいろいろ罪は犯してよいが、これらは４，５のステップがあるからこそ意味のあるもので、
「設計をないがしろにしてよい」というわけではない

[ラクスルの輪読会メモ](https://muramurasan.hatenablog.jp/entry/2018/02/02/090000)

### 第6章 テスト不足に気づいたら

5章でコピーアンドペーストしたコードを綺麗にするために、２つのクラスの親クラスとしてMoneyクラスを導入し、
#equalsの実装を共通化した章。

テストが十分にない又は全くないコードに対してTDDを行うことも今後あるだろう。
十分な量のテストがない場合、テストによって守られていないコードのリファクタリングを行わざるをえない。
テストがないまま、リファクタリングを続けてしまうとコードを破壊してしまう。
テストがない場合は、リファクタリングのためにテストコードを書く。

### 第7章 疑念をテストに翻訳する

FrancとDollarを比較してみると、テストが通ってしまう。

頭の中の悩みをテストで表現した
完璧ではないものの、まずますなやり方（getClass）でテストを通した
さらなる設計は、本当に必要になるまで先延ばしにした

### 第8章 実装を隠す

DollarとFrancが似通っているので、Moneyクラスに処理を移譲。
テストの方は直接 Dollar や Franc のコンストラクタを呼んでいた部分が factory method に置き換わっただけ

この変更で直接 Money のサブクラスを呼ぶ必要がなくなり、これらを削除する準備が進んだ。
## 参考

[TDDは死んだ。テスティングよ栄えよ。 by DHH](https://yattom.hatenablog.com/entries/2014/04/24#p1)
