---
author: "Hugo Authors"
title: "メタプログラミングRuby"
date: 2021-12-29
description: "メタプログラミングRubyの感想と要約をします"
draft: false
hideToc: false
enableToc: true
enableTocContent: false
author: ブシトラ
authorEmoji: 🐯
tags:
- ruby
- book
image: images/ruby/metapuro-ruby.jpeg
---

気になっていた。メタプロ。
感想を書いていく。

## はじめに

RubyやRuby on Railsを使いたい人は読むといいぽい

メタプログラミングはLispからやってきたもの。

I部では、

```
メソッド検索、Rubyのクラス
lambda
スコープ
```

Ⅱ部では、
```
メタプログラミングのケーススタディ
```

Ruby上級者向けの本ではないぽい

## 頭文字M

### 2-1.オープンクラス

メソッドが文字列でしか使われないと明確なため、Stringクラスに変更

```String.rb
def to_alphanumeric
  gsub(/[^\w\s]/, '')
end
```

### 2-1.1 クラス定義の内部

Rubyのclassは、クラス宣言というよりスコープ演算子のようなもの。
`オープンクラス`という。

ただStringとかを書き換えるモンキーパッチは危険そう。(感想)

[[Ruby] メタプログラミングの入り口、オープンクラスを理解する](https://qiita.com/kidach1/items/b1672f1c16e2d15f2d9c)

### 2.1.2 Monetizeの例

`Monetize`というgemを利用してオープンクラスを確認した

### 2.1.3 オープンクラスの問題点

replaceメソッドを定義しArrayクラスに寄せたが、すでにArrayにreplaceが元から生えているため、壊れる。モンキーパッチの悪い例

### 2-2 オブジェクトモデルの構造

クラスやオブジェクトのクラスには見た目以上に隠されているものが多い

### 2.2.1 オブジェクトの中身

同じメソッドでも、クラスに着目しているときは`インスタンスメソッド` で、 オブジェクトに着用しているときは`メソッド`と呼ぶ

```rb
class MyClass
  def my_method
    @v = 1
  end
end

obj = MyClass.new
obj.my_method
# obj は my_method というメソッドを持っていると言える

# MyClass は my_method というメソッドを持っているのではなく、
# my_methodのインスタンスメソッドを持っていると言える
# (メソッドを持っているというと、クラスメソッドとして使えるような文脈になる)

```

### 2.2.2 クラスの真相

クラスはオブジェクトである
```rb
 Array.superclass
 # Object
 Object.superclass
 # BasicObject
```

すべてのクラスはModule
```rb
Class.superclass
# Module
```

### 2.2.3 定数

定数と変数の違いは、スコープ。

### 2.2.4 オブジェクトとクラスのまとめ

```
オブジェクトのメソッドは、オブジェクトではなくオブジェクトのクラスに住んでいて
クラスのインスタンスメソッドと呼ばれる

クラスとは、オブジェクトにインスタンスメソッドの一覧とスーパークラスへの
リンクがついたものである
```

ここらへんこんがらがるからまた読み返したい

### 2.2.5 ネームスペースを使う

Action Mailer には Text クラスがあるので、
自前で Textクラスを実装することは出来ないが、moduleでラップすればいける

